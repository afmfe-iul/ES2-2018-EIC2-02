<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.3/d3.min.js"></script>
<style>
	body{
	    background-color: linen;
	}

	#right_part {
	    width:49%;
	    float:left;
	    display:inline-block;
	}

	#left_part {
	    float:left;
	    width:49%;
	    display:inline-block;
	}

	.svgHeader{
		align-items: center;
	}

	h1, h2{		
  		text-align: center;
	}
</style>
</head>
<body>
<script>
	d3.select("body")
		.append("div")
		.attr("id", "left_part")

	d3.select("body")
		.append("div")
		.attr("id", "right_part")

	///////////////	 LEFT PART 	//////////////////
	///////////////	 LEFT PART 	//////////////////

	d3.select("#left_part")
	    .append('div')
	    .html('<h2>Optimization Results</h2>');

	var WIDTH = 1200;
	var HEIGTH = 200;
	var PADDING = 30;
	var tooltips = [];
	var data = [30, 86, 168, 281, 303, 365];
	// TODO svgBottom will be used to show the FP/FN for example
	var chart = d3.select("#left_part")
	.append("div")
	.attr("class", "chart");

	d3.select(".chart")
			.selectAll("div")
		.data(data)
			.enter().append("div")
		.style("width", function(d) { return d  + "px"; })
		.text(function(d) { return d; })
		.style('background-color', "blue")
		.style("margin", "2px");
	
	
	d3.select('#left_part')
	    .append('div')
	    .html('<br/>');

	///////////////	 END LEFT PART 	//////////////////
	///////////////	 END LEFT PART 	//////////////////


	///////////////	 RIGHT PART 	//////////////////
	///////////////	 RIGHT PART 	//////////////////
	

	d3.select("#right_part")
	    .append('div')
	    .html('<h2>Comparison with known Solutions</h2>');

	// TODO svgBottom will be used to show the FP/FN for example
	var chartComparison = d3.select("#right_part")
	.append("div")
	.attr("class", "chartComparison");

	d3.select(".chartComparison")
			.selectAll("div")
		.data(data)
			.enter().append("div")
		.style("width", function(d) { return d  + "px"; })
		.text(function(d) { return d; })
		.style('background-color', "blue")
		.style("margin", "2px");
	
	
	d3.select('#right_part')
	    .append('div')
	    .html('<br/>');

	///////////////	 END RIGHT PART 	//////////////////
	///////////////	 END RIGHT PART 	//////////////////





	///////////////	 SVG PART 	//////////////////
	///////////////	 SVG PART 	//////////////////
	d3.select("body")
	    .append('div')
	    .html('<h1>Variables by Algorithm</h1>')
	    .attr("class", "svgHeader");


	var svgMain = d3.select("body").append("svg")
	.attr("width", WIDTH)
	.attr("id", "svg");
	// comment this to have normal coordinates again for mouse hover
	//.style("display", "block")
	//.style("margin", "auto");
	
	svgMain.append("rect")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("fill", "white");
	

	
	var xScale = d3.scalePoint().range([0, WIDTH]);
	var yScale = d3.scaleLinear().range([-HEIGTH/2 + PADDING, HEIGTH/2 - PADDING]);
	var colorScale = d3.scaleOrdinal(d3.schemeCategory10);

	var algorithms = [];
	var variableNames = [];
	d3.tsv("auxiliar.tsv", function (myArray){
		myArray.forEach(function(d){
			for(var key in d){
				algorithms.push(d[key]);				
			}
		});
		var h = HEIGTH * algorithms.length + PADDING * (algorithms.length - 1);
		svgMain.attr("height", h);
	});
	
	
	function convert(data){
		variableNames.push(data["variable"])
		for(i = 0; i < algorithms.length; i++){
			data[algorithms[i]] = +data[algorithms[i]];
		}
		return data;
	}
	
	function render(myArray){
		xScale.domain(variableNames);
		var bars = svgMain.selectAll("rect").data(myArray);
		var w = WIDTH / variableNames.length;
		
		for(i = 0; i < algorithms.length; i++){
			var extent = d3.extent(myArray, function(d){return d[algorithms[i]]});
		
			svgMain.append("text")
				.attr("transform", "translate(" + (WIDTH/2) + " ," + (HEIGTH + (HEIGTH + PADDING) * i) + ")")
		      	.style("text-anchor", "middle")
		      	.text(algorithms[i]);
			
			yScale.domain(extent);
			var chartHeight = d3.select(".svgHeader").node().getBoundingClientRect()["bottom"] + 20;
			// variable name tooltip
			tooltips.push(
					d3.select("body")
					.append("div")
					.style("position", "absolute")
					.style("z-index", "10")
					.style("top", chartHeight + (HEIGTH + PADDING) * i + "px"));
			// variable value tooltip
			tooltips.push(
					d3.select("body")
					.append("div")
					.style("position", "absolute")
					.style("z-index", "10")
					.style("top", chartHeight + (HEIGTH + PADDING) * i + 13 + "px"));
			
			bars.enter().append("rect")
				.attr("x", function(d){return xScale(d["variable"]);})
				.attr("y", function(d){
					var value = yScale(d[algorithms[i]]);
					if(value < 0){
						return HEIGTH/2 + (HEIGTH + PADDING) * i;
					}else{
						return HEIGTH/2 - value + (HEIGTH + PADDING) * i;						
					}	
				})
				.attr("width", w)
				.attr("height", function(d){
					var value = yScale(d[algorithms[i]]);
					if(value > 0){
						return value;
					}else{
						return 0 - value;						
					}	
				})
				.style("fill", colorScale(i));
			
			svgMain.append("line")
			.attr("x1", 0)
			.attr("y1", HEIGTH/2 + (HEIGTH + PADDING) * i)
			.attr("x2", WIDTH)
			.attr("y2",HEIGTH/2 + (HEIGTH + PADDING) * i)
			.attr("stroke-width", 1)
			.attr("stroke", "black");
		}
		bars.exit().remove();
		
		svgMain
		.on("mouseenter ", function() {
			for(i = 0; i < tooltips.length; i++){
				tooltips[i].style("display", null);
			}
		})
		.on("mouseleave ", function() {
			d3.select("#id").remove();
			for(i = 0; i < tooltips.length; i++){
				tooltips[i].style("display", "none");
			}
		})
		.on("mousemove", function(){
				var mouseX = d3.event.pageX - 8;
				d3.select("#id").remove();	
				svgMain.append("line")
				.attr("id", "id")
				.attr("x1", mouseX)
				.attr("y1", 0)
				.attr("x2", mouseX)
				.attr("y2", svgMain.node().getBBox().height + PADDING)
				.attr("stroke-width", 2)
				.attr("stroke", "black");
				
				for(i = 0; i < algorithms.length; i++){
					// variable value tooltip
					tooltips[i*2].text(myArray[(mouseX - 2)/w | 0]["variable"])
					.style("left", d3.event.pageX + 4 + "px");
					// variable name tooltip
					tooltips[i*2 + 1].text(myArray[(mouseX - 2)/w | 0][algorithms[i]])
					.style("left", d3.event.pageX + 4 + "px");
				}
			});
	}
	
	d3.tsv("data.tsv", convert, render);
</script>
</body>
</html>